---
title: "db_build"
format: html
editor: visual
---

## load packages

```{r}
#| output: false
if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}

librarian::shelf(tidyverse, RPostgres, DBI, here)

```

```{r}
#| output: false
tryCatch({
    drv <- dbDriver("Postgres")
    print("Connecting to Databaseâ€¦")
    connection <- dbConnect(drv,
                 dbname = Sys.getenv("aws_dbname"),
                 host = Sys.getenv("aws_host"),
                 port = Sys.getenv("aws_port"),
                 user = Sys.getenv("aws_user"),
                 password = Sys.getenv("aws_password"),
                 timezone=NULL)
    print("Database Connected!")
    },
    error=function(cond) {
            print("Unable to connect to Database.")
    })

# set schema path
dbExecute(connection, "set search_path to 'bay_area'")
```

## Site table build

```{r}

# location
dbExecute(connection, "alter table site add primary key(site_id);")

# wetland info
dbExecute(connection, "alter table wetland_info add primary key(survey_id);")

dbExecute(connection,
          "alter table wetland_info  
           add constraint fk_wetland foreign key (site_id) 
          references site (site_id);")

# water info - still needs work
dbExecute(connection, "alter table water_quality_info add primary key(water_id);")

dbExecute(connection,
          "alter table water_quality_info  
           add constraint fk_water foreign key (water_id) 
          references  wetland_info (water_id);")

# amphib dissect
dbExecute(connection, "alter table amphib_dissect add primary key(dissect_id);")

dbExecute(connection,
          "alter table amphib_dissect  
           add constraint fk_amphib_dissect foreign key (survey_id) 
          references wetland_info (survey_id);")

# amphib parasite
dbExecute(connection, "alter table amphib_parasite add primary key(parasite_id);")

dbExecute(connection,
          "alter table amphib_parasite  
           add constraint fk_amphib_parasite foreign key (dissect_id) 
          references amphib_dissect (dissect_id);")

# Bd 
dbExecute(connection, "alter table amphib_dissect add primary key(bd_id);")

dbExecute(connection,
          "alter table bd_results  
           add constraint fk_bd foreign key (bd_id) 
          references amphib_dissect (bd_id);")



```
